{"version":3,"file":"bullet.js","names":["Axis","Mesh","MeshBuilder","meshes","night_monster_list","serverMessages","ws","Avatar","scene","sphere1","distance","removeFromList","Bullet","id","constructor","myShooter","displayOnly","p","name","addChild","createSphere","angle","getDirection","Z","position","clone","originalPositionBullet","speedCoeff","rotation","push","x","z","checkCollisions","damage","onCollide","e","parent","avatar","includes","console","log","send","JSON","stringify","route","DAMAGE_MONSTER","content","username","dispose","sphere","CreateSphere","diameter","segments","update","moveWithCollisions","scale","bulletList"],"sources":["../../../src/clients/babylon/bullet.ts"],"sourcesContent":["import { Axis, Mesh, MeshBuilder, Vector3 } from \"babylonjs\";\r\nimport { meshes, night_monster_list, serverMessages, ws } from \"../connectionWS\";\r\nimport { Avatar } from \"./avatars/avatar\";\r\nimport { scene, sphere1 } from \"./main\";\r\nimport { distance, removeFromList } from \"./tools\";\r\n\r\nexport class Bullet extends Mesh {\r\n  myShooter: Avatar;\r\n  name: string;\r\n  static id = 0;\r\n  angle: Vector3;\r\n  speedCoeff: number;\r\n  displayOnly: Boolean;\r\n  originalPositionBullet: Vector3;\r\n  damage: number;\r\n\r\n  constructor(myShooter: Avatar, displayOnly: Boolean, p?: { damage?: number }) {\r\n    super(\"Bullet\" + Bullet.id + myShooter.name);\r\n    this.name = \"Bullet\" + Bullet.id + myShooter.name;\r\n    this.displayOnly = displayOnly;\r\n    this.myShooter = myShooter;\r\n    this.addChild(this.createSphere())\r\n    this.angle = myShooter.getDirection(Axis.Z)\r\n    this.position = this.myShooter.position.clone();\r\n    this.originalPositionBullet = this.position.clone()\r\n    this.speedCoeff = 0.05;\r\n    this.rotation = this.angle\r\n    meshes.push(this)\r\n    this.position.x = this.position.x + this.angle.x * 3;\r\n    this.position.z = this.position.z + this.angle.z * 3;\r\n    this.checkCollisions = true;\r\n    this.damage = p?.damage || 10;\r\n    Bullet.id++;\r\n\r\n    this.onCollide = e => {\r\n      if (e?.parent instanceof Avatar) {\r\n        let avatar = e.parent as Avatar;\r\n        if (avatar.name.includes(\"zombie\") && this.myShooter.name === sphere1!.name) {\r\n          console.log(\"HERE\");\r\n          console.log(night_monster_list);\r\n\r\n          ws.send(\r\n            JSON.stringify({\r\n              route: serverMessages.DAMAGE_MONSTER,\r\n              content: JSON.stringify({ username: avatar.name, damage: this.damage })\r\n            }))\r\n        }\r\n      }\r\n      this.dispose()\r\n    }\r\n  }\r\n\r\n  createSphere(): Mesh {\r\n    let sphere = MeshBuilder.CreateSphere(this.name + \"model\", {\r\n      diameter: 0.5,\r\n      segments: 16\r\n    }, scene);\r\n    return sphere\r\n  }\r\n\r\n  update() {\r\n    if (this.speedCoeff <= 0.02) this.dispose();\r\n    this.moveWithCollisions(this.angle.scale(this.speedCoeff))\r\n    // this.position.x = this.position.x + this.angle.x * this.speedCoeff;\r\n    // this.position.z = this.position.z + this.angle.z * this.speedCoeff;\r\n    if (distance(this.position, this.originalPositionBullet) > 15) {\r\n      this.dispose()\r\n    }\r\n  }\r\n\r\n  dispose(): void {\r\n    super.dispose()\r\n    removeFromList(this, this.myShooter.bulletList)\r\n    removeFromList(this, meshes)\r\n  }\r\n}"],"mappings":"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"}