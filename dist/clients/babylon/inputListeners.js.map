{"version":3,"file":"inputListeners.js","names":["Axis","chatRef","input","canvas","sphere1","createInputStates","jump","goForeward","goLeft","goBackward","goRight","rotateRight","rotateLeft","attack","inputStates","inializeInputListeners","addEventListener","evt","keyListener","keyPressListener","code","current","enterChat","mouseListener","pointerLockAndMouseMove","isPressed","document","activeElement","which","requestPointerLock","mozRequestPointerLock","movementX","rotate","Y","Math","sqrt","didSomething","isLocked","pointerLockElement","onpointerdown","toggleChat"],"sources":["../../../src/clients/babylon/inputListeners.ts"],"sourcesContent":["import { Axis } from \"babylonjs\";\r\nimport { chatRef } from \"../..\";\r\nimport { input } from \"../reactComponents/chat\";\r\nimport { canvas, sphere1 } from \"./main\";\r\n\r\nexport type InputStates = {\r\n    jump: boolean,\r\n    goForeward: boolean\r\n    goLeft: boolean,\r\n    goBackward: boolean,\r\n    goRight: boolean,\r\n    rotateRight: boolean,\r\n    rotateLeft: boolean,\r\n    attack: boolean\r\n}\r\n\r\nlet createInputStates = (): InputStates => {\r\n    return {\r\n        jump: false,\r\n        goForeward: false,\r\n        goLeft: false,\r\n        goBackward: false,\r\n        goRight: false,\r\n        rotateRight: false,\r\n        rotateLeft: false,\r\n        attack: false\r\n    }\r\n}\r\n\r\nexport let inputStates: InputStates;\r\n\r\nexport function inializeInputListeners() {\r\n    inputStates = createInputStates()\r\n\r\n    canvas.addEventListener('keydown', (evt) => {\r\n        keyListener(evt, true)\r\n    });\r\n\r\n    canvas.addEventListener('keyup', (evt) => {\r\n        keyListener(evt, false)\r\n    });\r\n\r\n    canvas.addEventListener(\"keypress\", (evt) => {\r\n        keyPressListener(evt)\r\n    })\r\n\r\n    canvas.addEventListener('keydown', (evt) => {\r\n        if ((evt.code === \"Enter\" || evt.code === \"NumpadEnter\")) {\r\n            inputStates = createInputStates()\r\n            chatRef.current!.enterChat()\r\n        }\r\n    });\r\n\r\n    canvas.addEventListener('mousedown', (evt) => {\r\n        mouseListener(evt, true)\r\n    });\r\n\r\n    canvas.addEventListener('mouseup', (evt) => {\r\n        mouseListener(evt, false)\r\n    });\r\n\r\n    pointerLockAndMouseMove();\r\n}\r\n\r\nfunction keyListener(evt: KeyboardEvent, isPressed: boolean) {\r\n\r\n    if ((input === document.activeElement) && isPressed) { return }\r\n\r\n    // tirer\r\n    if (evt.code === \"Space\") {\r\n        inputStates.jump = isPressed;\r\n    }\r\n\r\n    // movements\r\n    else if (evt.code === \"KeyW\") {\r\n        inputStates.goForeward = isPressed;\r\n    }\r\n    else if (evt.code === \"KeyS\") {\r\n        inputStates.goBackward = isPressed;\r\n    }\r\n    else if (evt.code === \"KeyA\") {\r\n        inputStates.goLeft = isPressed;\r\n    }\r\n    else if (evt.code === \"KeyD\") {\r\n        inputStates.goRight = isPressed;\r\n    }\r\n\r\n    //rotation\r\n    else if (evt.code === \"ArrowRight\") {\r\n        inputStates.rotateRight = isPressed;\r\n    }\r\n    else if (evt.code === \"ArrowLeft\") {\r\n        inputStates.rotateLeft = isPressed;\r\n    }\r\n}\r\n\r\nfunction mouseListener(evt: MouseEvent, isPressed: boolean) {\r\n    if ((input === document.activeElement) && isPressed) { return }\r\n    switch (evt.which) {\r\n        case 1:\r\n            inputStates.attack = isPressed;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n}\r\n\r\nexport function pointerLockAndMouseMove() {\r\n    canvas.requestPointerLock = canvas.requestPointerLock ||\r\n        canvas.mozRequestPointerLock; // || (<any>canvas).webkitPointerLockElement\r\n\r\n    //turret direction is responding to cursor movements\r\n    canvas.addEventListener(\"mousemove\", (evt) => {\r\n        if (sphere1) {\r\n            if (evt.movementX > 0) {\r\n                sphere1.rotate(Axis.Y, Math.sqrt(evt.movementX) / 200);\r\n                sphere1.didSomething = true;\r\n            }\r\n            if (evt.movementX < 0) {\r\n                sphere1.rotate(Axis.Y, - Math.sqrt(-evt.movementX) / 200);\r\n                sphere1.didSomething = true;\r\n            }\r\n        }\r\n    });\r\n\r\n    let isLocked = () => document.pointerLockElement === canvas; // || (<any>document).mozPointerLockElement === canvas\r\n\r\n    canvas.onpointerdown = function () {\r\n        if (!isLocked()) canvas.requestPointerLock();\r\n    }\r\n}\r\n\r\nlet keyPressListener = (evt: KeyboardEvent) => {\r\n    if (evt.code === \"KeyC\") {\r\n        chatRef.current!.toggleChat()\r\n    }\r\n}\r\n"],"mappings":"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"}