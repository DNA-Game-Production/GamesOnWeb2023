{"version":3,"file":"main.js","names":["Engine","FollowCamera","Vector3","player_list","username","initChat","inializeInputListeners","createScene","canvas","engine","scene","sphere1","doneOnce","startRenderLoop","runRenderLoop","activeCamera","render","forEach","e","updateBulletPosition","move","resize","createDefaultEngine","preserveDrawingBuffer","stencil","disableWebGL2Support","initFunction","document","getElementById","asyncEngineCreation","console","error","window","addEventListener","Error","set_my_sphere","dispose","player_sphere","get","cameraBuilder","name","position","multiply","rotationOffset","setScene","undefined","BABYLON"],"sources":["../../../src/clients/babylon/main.ts"],"sourcesContent":["import { Engine, FollowCamera, Ray, Scene, Vector3 } from \"babylonjs\";\r\nimport { player_list, username } from \"../connectionWS\";\r\nimport { initChat } from \"../reactComponents/chat\";\r\nimport { Avatar } from \"./avatars/avatar\";\r\n\r\nimport { inializeInputListeners } from \"./inputListeners\";\r\nimport { createScene } from \"./scene\";\r\n\r\nexport var canvas: HTMLCanvasElement;\r\nexport var engine: Engine;\r\nexport var scene: Scene;\r\nexport var sphere1: Avatar | undefined;\r\n\r\nlet doneOnce = false;\r\n\r\nvar startRenderLoop = function (engine: Engine, canvas: HTMLCanvasElement) {\r\n  engine.runRenderLoop(function () {\r\n    if (scene && scene.activeCamera) {\r\n      scene.render();\r\n      player_list.forEach(e => e.updateBulletPosition())\r\n      sphere1?.move();\r\n    }\r\n  });\r\n  engine.resize()\r\n}\r\n\r\nvar createDefaultEngine = function () { return new Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true, disableWebGL2Support: false }); };\r\n\r\nexport let initFunction = async function () {\r\n  if (doneOnce) return\r\n  doneOnce = true\r\n  canvas = document.getElementById(\"canvas\") as HTMLCanvasElement\r\n\r\n  initChat();\r\n\r\n  var asyncEngineCreation = async function () {\r\n    try {\r\n      return createDefaultEngine();\r\n    } catch (e) {\r\n      console.error(\"the available createEngine function failed. Creating the default engine instead\");\r\n      return createDefaultEngine();\r\n    }\r\n  }\r\n\r\n  engine = await asyncEngineCreation();\r\n  // engine.displayLoadingUI();\r\n\r\n  // Resize\r\n  window.addEventListener(\"resize\", function () {\r\n    engine.resize();\r\n  });\r\n  window.engine = engine;\r\n  if (!engine) throw new Error('engine should not be null.');\r\n  startRenderLoop(engine, canvas);\r\n\r\n  let scene = createScene();\r\n\r\n  inializeInputListeners();\r\n  return scene\r\n};\r\n\r\nexport function set_my_sphere() {\r\n  sphere1?.dispose();\r\n  let player_sphere = player_list.get(username);\r\n  if (player_sphere) {\r\n    //scene.setActiveCameraByName(player_sphere.cameraAvatar.name)\r\n    sphere1 = player_sphere;\r\n\r\n    let cameraBuilder = new FollowCamera(sphere1.name + \"Camera\", sphere1.position.multiply(new Vector3(1, -1, 1)), scene, sphere1);\r\n    cameraBuilder.rotationOffset = 180;\r\n    scene.activeCamera = cameraBuilder;\r\n  }\r\n}\r\n\r\nexport function setScene(e: Scene | undefined) {\r\n  if (e === undefined) {\r\n    throw new Error(\"Undefined Scene\")\r\n  } else {\r\n    scene = e\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface Window {\r\n    addAvatar: (() => Avatar),\r\n    playerList: Map<string, Avatar>,\r\n    scene: Scene,\r\n    engine: Engine\r\n    BABYLON: any;\r\n  }\r\n}\r\n\r\nwindow.BABYLON = BABYLON;"],"mappings":"AAAA,OAASA,MAAT,CAAiBC,YAAjB,CAA2CC,OAA3C,KAA0D,WAA1D,CACA,OAASC,WAAT,CAAsBC,QAAtB,KAAsC,iBAAtC,CACA,OAASC,QAAT,KAAyB,yBAAzB,CAGA,OAASC,sBAAT,KAAuC,kBAAvC,CACA,OAASC,WAAT,KAA4B,SAA5B,CAEA,MAAO,IAAIC,OAAJ,CACP,MAAO,IAAIC,OAAJ,CACP,MAAO,IAAIC,MAAJ,CACP,MAAO,IAAIC,QAAJ,CAEP,GAAIC,SAAQ,CAAG,KAAf,CAEA,GAAIC,gBAAe,CAAG,SAAUJ,MAAV,CAA0BD,MAA1B,CAAqD,CACzEC,MAAM,CAACK,aAAP,CAAqB,UAAY,CAC/B,GAAIJ,KAAK,EAAIA,KAAK,CAACK,YAAnB,CAAiC,CAC/BL,KAAK,CAACM,MAAN,GACAb,WAAW,CAACc,OAAZ,CAAoBC,CAAC,EAAIA,CAAC,CAACC,oBAAF,EAAzB,EACAR,OAAO,EAAES,IAAT,EACD,CACF,CAND,EAOAX,MAAM,CAACY,MAAP,EACD,CATD,CAWA,GAAIC,oBAAmB,CAAG,UAAY,CAAE,MAAO,IAAItB,OAAJ,CAAWQ,MAAX,CAAmB,IAAnB,CAAyB,CAAEe,qBAAqB,CAAE,IAAzB,CAA+BC,OAAO,CAAE,IAAxC,CAA8CC,oBAAoB,CAAE,KAApE,CAAzB,CAAwG,CAAvJ,CAEA,MAAO,IAAIC,aAAY,CAAG,gBAAkB,CAC1C,GAAId,QAAJ,CAAc,OACdA,QAAQ,CAAG,IAAX,CACAJ,MAAM,CAAGmB,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAAT,CAEAvB,QAAQ,GAER,GAAIwB,oBAAmB,CAAG,gBAAkB,CAC1C,GAAI,CACF,MAAOP,oBAAmB,EAC3B,CAAC,MAAOJ,CAAP,CAAU,CACVY,OAAO,CAACC,KAAR,CAAc,iFAAd,EACA,MAAOT,oBAAmB,EAC3B,CACF,CAPD,CASAb,MAAM,CAAG,KAAMoB,oBAAmB,EAAlC,CAIAG,MAAM,CAACC,gBAAP,CAAwB,QAAxB,CAAkC,UAAY,CAC5CxB,MAAM,CAACY,MAAP,EACD,CAFD,EAGAW,MAAM,CAACvB,MAAP,CAAgBA,MAAhB,CACA,GAAI,CAACA,MAAL,CAAa,KAAM,IAAIyB,MAAJ,CAAU,4BAAV,CAAN,CACbrB,eAAe,CAACJ,MAAD,CAASD,MAAT,CAAf,CAEA,GAAIE,MAAK,CAAGH,WAAW,EAAvB,CAEAD,sBAAsB,GACtB,MAAOI,MACR,CA/BM,CAiCP,MAAO,SAASyB,cAAT,EAAyB,CAC9BxB,OAAO,EAAEyB,OAAT,GACA,GAAIC,cAAa,CAAGlC,WAAW,CAACmC,GAAZ,CAAgBlC,QAAhB,CAApB,CACA,GAAIiC,aAAJ,CAAmB,CAEjB1B,OAAO,CAAG0B,aAAV,CAEA,GAAIE,cAAa,CAAG,GAAItC,aAAJ,CAAiBU,OAAO,CAAC6B,IAAR,CAAe,QAAhC,CAA0C7B,OAAO,CAAC8B,QAAR,CAAiBC,QAAjB,CAA0B,GAAIxC,QAAJ,CAAY,CAAZ,CAAe,CAAC,CAAhB,CAAmB,CAAnB,CAA1B,CAA1C,CAA4FQ,KAA5F,CAAmGC,OAAnG,CAApB,CACA4B,aAAa,CAACI,cAAd,CAA+B,GAA/B,CACAjC,KAAK,CAACK,YAAN,CAAqBwB,aACtB,CACF,CAED,MAAO,SAASK,SAAT,CAAkB1B,CAAlB,CAAwC,CAC7C,GAAIA,CAAC,GAAK2B,SAAV,CAAqB,CACnB,KAAM,IAAIX,MAAJ,CAAU,iBAAV,CACP,CAFD,IAEO,CACLxB,KAAK,CAAGQ,CACT,CACF,CAYDc,MAAM,CAACc,OAAP,CAAiBA,OAAjB"}